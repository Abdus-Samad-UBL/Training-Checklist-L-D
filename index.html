<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L&D Training Checklist Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .view-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .form-section {
            background: #f9fafb;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .training-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .training-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .training-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .training-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .training-card p {
            color: #6b7280;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .training-card .progress {
            margin-top: 15px;
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .training-card .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s;
        }

        .checklist-section {
            margin-bottom: 30px;
        }

        .checklist-section h2 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .checklist-section.locked {
            opacity: 0.5;
            pointer-events: none;
        }

        .checklist-section.locked h2 {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
        }

        .section-status {
            font-size: 14px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .section-status.active {
            background: #10b981;
        }

        .section-status.locked {
            background: rgba(255, 255, 255, 0.3);
        }

        .checklist-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            transition: all 0.3s;
        }

        .checklist-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }

        .checklist-item.completed {
            background: #f0fdf4;
            border-color: #10b981;
        }

        .checklist-item input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .checklist-item-content {
            flex: 1;
        }

        .checklist-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            gap: 15px;
        }

        .checklist-item-title {
            font-weight: 600;
            color: #1f2937;
            flex: 1;
        }

        .checklist-item.completed .checklist-item-title {
            color: #10b981;
        }

        .checklist-item-details {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 13px;
            color: #6b7280;
        }

        .detail-badge {
            background: #f3f4f6;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 500;
        }

        .signature-input {
            margin-top: 10px;
            padding: 8px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            width: 100%;
            max-width: 300px;
            font-size: 14px;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 36px;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 14px;
            opacity: 0.9;
        }

        .actions-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .info-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box h4 {
            color: #92400e;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .info-box p {
            color: #78350f;
            font-size: 14px;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .training-list {
                grid-template-columns: 1fr;
            }

            .checklist-item {
                flex-direction: column;
            }

            .checklist-item-header {
                flex-direction: column;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì L&D Training Checklist Manager</h1>
            <p>Manage your training sessions with ease</p>
        </div>

        <div class="main-content">
            <!-- Dashboard View -->
            <div id="dashboardView">
                <div class="view-selector">
                    <button class="btn btn-primary" onclick="showCreateForm()">
                        ‚ûï Create New Training
                    </button>
                    <button class="btn btn-secondary" onclick="exportAllData()">
                        üì• Export All Data
                    </button>
                    <button class="btn btn-secondary" onclick="importData()">
                        üì§ Import Data
                    </button>
                </div>

                <div id="trainingListContainer">
                    <h2 style="margin-bottom: 20px; color: #1f2937;">Your Training Sessions</h2>
                    <div id="trainingList" class="training-list"></div>
                </div>
            </div>

            <!-- Create/Edit Training View -->
            <div id="createView" class="hidden">
                <button class="btn btn-secondary back-button" onclick="showDashboard()">
                    ‚Üê Back to Dashboard
                </button>
                
                <div class="form-section">
                    <h2 style="margin-bottom: 20px; color: #1f2937;" id="formTitle">Create New Training</h2>
                    
                    <div class="form-group">
                        <label for="trainingTitle">Training Title *</label>
                        <input type="text" id="trainingTitle" placeholder="Enter training title" required>
                    </div>

                    <div class="form-group">
                        <label for="trainingStartDate">Training Start Date *</label>
                        <input type="date" id="trainingStartDate" required>
                    </div>

                    <div class="form-group">
                        <label for="trainingEndDate">Training End Date *</label>
                        <input type="date" id="trainingEndDate" required>
                    </div>

                    <div class="form-group">
                        <label for="checkerName">Checker Name *</label>
                        <input type="text" id="checkerName" placeholder="Enter checker name" required>
                    </div>

                    <div class="form-group">
                        <label for="venue">Venue *</label>
                        <input type="text" id="venue" placeholder="Enter venue" required>
                    </div>

                    <button class="btn btn-success" onclick="saveTraining()" style="width: 100%;">
                        üíæ Save Training
                    </button>
                </div>
            </div>

            <!-- Checklist View -->
            <div id="checklistView" class="hidden">
                <button class="btn btn-secondary back-button" onclick="showDashboard()">
                    ‚Üê Back to Dashboard
                </button>

                <div class="actions-bar">
                    <button class="btn btn-primary" onclick="editTrainingInfo()">
                        ‚úèÔ∏è Edit Training Info
                    </button>
                    <button class="btn btn-secondary" onclick="exportTrainingData()">
                        üì• Export This Training
                    </button>
                    <button class="btn btn-danger" onclick="deleteTraining()">
                        üóëÔ∏è Delete Training
                    </button>
                </div>

                <div id="trainingHeader" class="form-section"></div>

                <div id="phaseInfo" class="info-box" style="display: none;">
                    <h4 id="phaseTitle">üìç Current Phase</h4>
                    <p id="phaseDescription"></p>
                </div>

                <div class="stats-section">
                    <div class="stat-card">
                        <h3 id="totalItems">0</h3>
                        <p>Total Items</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="completedItems">0</h3>
                        <p>Completed</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="progressPercentage">0%</h3>
                        <p>Progress</p>
                    </div>
                </div>

                <div class="info-box">
                    <h4>üìã Dress Code Information</h4>
                    <p><strong>Weekdays Training:</strong> Formal dress code as mentioned in Bank's dress code policy</p>
                    <p><strong>Weekend Training:</strong> Smart Casual. Dress code guidelines should be attached in course announcement email.</p>
                </div>

                <div id="checklistContainer"></div>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileImport(event)">

    <script>
        // Data structure for checklist items
        const checklistData = {
            preTraining: {
                title: "Pre-Training Arrangements",
                items: [
                    { id: 1, action: "Course announcement", timeline: "1 week before commencement of training", responsibility: "" },
                    { id: 2, action: "Confirmation from trainer", timeline: "", responsibility: "" },
                    { id: 3, action: "Availability of course material", timeline: "", responsibility: "" },
                    { id: 4, action: "Pre & Post Assessment Mandatory for every training", timeline: "", responsibility: "" },
                    { id: 5, action: "Confirmation of Nominations", timeline: "3 days before commencement of training", responsibility: "" },
                    { id: 6, action: "Confirmation email to participants - Must be on standardised format", timeline: "1 day before commencement of training", responsibility: "" },
                    { id: 7, action: "Reminder email to the Trainer - Through outlook calendar", timeline: "2 days before commencement of training", responsibility: "" },
                    { id: 8, action: "Arrangement of trainer travel if coming from outstation", timeline: "3 days before commencement of training", responsibility: "" },
                    { id: 9, action: "Confirmation of Proposed Trainer/Alternate Option", timeline: "1 Week before the commencement of the session", responsibility: "" },
                    { id: 10, action: "Hotel/travel stay arrangement of the Trainer", timeline: "", responsibility: "" },
                    { id: 11, action: "Travel Arrangement of outstation the participants", timeline: "", responsibility: "" },
                    { id: 12, action: "Hotel stay of the participants", timeline: "", responsibility: "" },
                    { id: 13, action: "Arrangement of training material (From Trainer) for training activities (in case of special arrangements, approval is required)", timeline: "1 week before commencement of training", responsibility: "" },
                    { id: 14, action: "Stationery Arrangement (writing pads, flip charts, markers)", timeline: "", responsibility: "" },
                    { id: 15, action: "Handouts Arrangement", timeline: "", responsibility: "" },
                    { id: 16, action: "Seating arrangements", timeline: "", responsibility: "" },
                    { id: 17, action: "Soft mints/candies/chocolates", timeline: "", responsibility: "" },
                    { id: 18, action: "Music/Sound system", timeline: "", responsibility: "" },
                    { id: 19, action: "Any other please specify", timeline: "", responsibility: "" },
                    { id: 20, action: "Classroom setting", timeline: "", responsibility: "" },
                    { id: 21, action: "Multimedia", timeline: "", responsibility: "" },
                    { id: 22, action: "Video conferencing + Link Creation of online training sessions", timeline: "", responsibility: "" },
                    { id: 23, action: "Lunch tea/Refreshment arrangements", timeline: "1 day before commencement of training", responsibility: "" },
                    { id: 24, action: "Photographer", timeline: "2 days prior to the training", responsibility: "" }
                ]
            },
            trainingDay: {
                title: "Training Day",
                items: [
                    { id: 1, action: "Attendance sheet", timeline: "1 day before commencement of training", responsibility: "" },
                    { id: 2, action: "Meal timings Tea & Lunch (to be confirmed/communicated from/to trainer before start of training)", timeline: "Same day", responsibility: "" },
                    { id: 3, action: "Handouts", timeline: "1 day before commencement of training", responsibility: "" },
                    { id: 4, action: "Classroom setting", timeline: "", responsibility: "" },
                    { id: 5, action: "Availability of training material in class", timeline: "", responsibility: "" },
                    { id: 6, action: "Water dispenser", timeline: "", responsibility: "" },
                    { id: 7, action: "Room temperature", timeline: "Same day", responsibility: "" },
                    { id: 8, action: "Installation of laptop for presentation", timeline: "1 day before commencement of training", responsibility: "" },
                    { id: 9, action: "Sound system/Music", timeline: "", responsibility: "" },
                    { id: 10, action: "Pre post test link", timeline: "", responsibility: "" },
                    { id: 11, action: "Feedback Form", timeline: "", responsibility: "" },
                    { id: 12, action: "Group Photograph (Group Photo is mandatory to keep in record in soft)", timeline: "Same day", responsibility: "" },
                    { id: 13, action: "Certificate printing (In house session) on Standardised Format", timeline: "Same day", responsibility: "" },
                    { id: 14, action: "Certificate Printing & Dispatch (Mobile Session)", timeline: "1 week after the commencement of training", responsibility: "" }
                ]
            },
            postTraining: {
                title: "Post Training",
                items: [
                    { id: 1, action: "Thank you email to the participants and trainers (To seek Feed back)", timeline: "1 Day after training", responsibility: "" },
                    { id: 2, action: "Compilation of Pre/Post Assessment Results", timeline: "2 days after training", responsibility: "" },
                    { id: 3, action: "Compilation of Feedback", timeline: "2 days after training", responsibility: "" },
                    { id: 4, action: "Course Detail in MIS + U-Fusion", timeline: "Within 1 week of the training", responsibility: "" }
                ]
            }
        };

        // Application state
        let trainings = JSON.parse(localStorage.getItem('trainings')) || [];
        let currentTrainingId = null;
        let editMode = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showDashboard();
        });

        // View Management
        function showDashboard() {
            hideAllViews();
            document.getElementById('dashboardView').classList.remove('hidden');
            renderTrainingList();
        }

        function showCreateForm() {
            hideAllViews();
            document.getElementById('createView').classList.remove('hidden');
            document.getElementById('formTitle').textContent = 'Create New Training';
            clearForm();
            editMode = false;
            currentTrainingId = null;
        }

        function showChecklist(trainingId) {
            currentTrainingId = trainingId;
            const training = trainings.find(t => t.id === trainingId);
            
            if (!training) {
                alert('Training not found!');
                return;
            }

            hideAllViews();
            document.getElementById('checklistView').classList.remove('hidden');
            
            renderTrainingHeader(training);
            renderChecklist(training);
            updateStats(training);
        }

        function hideAllViews() {
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('createView').classList.add('hidden');
            document.getElementById('checklistView').classList.add('hidden');
        }

        // Training Management
        function saveTraining() {
            const title = document.getElementById('trainingTitle').value.trim();
            const startDate = document.getElementById('trainingStartDate').value;
            const endDate = document.getElementById('trainingEndDate').value;
            const checker = document.getElementById('checkerName').value.trim();
            const venue = document.getElementById('venue').value.trim();

            if (!title || !startDate || !endDate || !checker || !venue) {
                alert('Please fill in all required fields!');
                return;
            }

            // Validate that end date is not before start date
            if (new Date(endDate) < new Date(startDate)) {
                alert('End date cannot be before start date!');
                return;
            }

            if (editMode && currentTrainingId) {
                // Update existing training
                const training = trainings.find(t => t.id === currentTrainingId);
                training.title = title;
                training.startDate = startDate;
                training.endDate = endDate;
                training.checkerName = checker;
                training.venue = venue;
            } else {
                // Create new training
                const newTraining = {
                    id: Date.now(),
                    title: title,
                    startDate: startDate,
                    endDate: endDate,
                    checkerName: checker,
                    venue: venue,
                    createdAt: new Date().toISOString(),
                    checklist: initializeChecklist()
                };
                trainings.push(newTraining);
            }

            saveToLocalStorage();
            showDashboard();
        }

        function editTrainingInfo() {
            const training = trainings.find(t => t.id === currentTrainingId);
            if (!training) return;

            editMode = true;
            
            document.getElementById('trainingTitle').value = training.title;
            document.getElementById('trainingStartDate').value = training.startDate;
            document.getElementById('trainingEndDate').value = training.endDate;
            document.getElementById('checkerName').value = training.checkerName;
            document.getElementById('venue').value = training.venue;
            document.getElementById('formTitle').textContent = 'Edit Training Information';

            hideAllViews();
            document.getElementById('createView').classList.remove('hidden');
        }

        function deleteTraining() {
            if (!confirm('Are you sure you want to delete this training? This action cannot be undone.')) {
                return;
            }

            trainings = trainings.filter(t => t.id !== currentTrainingId);
            saveToLocalStorage();
            showDashboard();
        }

        function initializeChecklist() {
            const checklist = {};
            
            for (const [section, data] of Object.entries(checklistData)) {
                checklist[section] = data.items.map(item => ({
                    ...item,
                    completed: false,
                    signature: ''
                }));
            }

            return checklist;
        }

        // Determine active section based on current date and training dates
        function getActiveSection(training) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const startDate = new Date(training.startDate);
            startDate.setHours(0, 0, 0, 0);
            
            const endDate = new Date(training.endDate);
            endDate.setHours(0, 0, 0, 0);

            if (today < startDate) {
                // Before training starts - Pre-Training section is active
                return 'preTraining';
            } else if (today >= startDate && today <= endDate) {
                // During training - Training Day section is active
                return 'trainingDay';
            } else {
                // After training ends - Post Training section is active
                return 'postTraining';
            }
        }

        function getSectionStatus(sectionKey, activeSection) {
            if (sectionKey === activeSection) {
                return { locked: false, label: 'üîì Active Now' };
            } else {
                const sectionOrder = ['preTraining', 'trainingDay', 'postTraining'];
                const activeSectionIndex = sectionOrder.indexOf(activeSection);
                const currentSectionIndex = sectionOrder.indexOf(sectionKey);
                
                if (currentSectionIndex < activeSectionIndex) {
                    return { locked: true, label: '‚úÖ Completed Phase' };
                } else {
                    return { locked: true, label: 'üîí Locked' };
                }
            }
        }

        // Rendering Functions
        function renderTrainingList() {
            const container = document.getElementById('trainingList');
            
            if (trainings.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <h3>No Training Sessions Yet</h3>
                        <p>Click "Create New Training" to get started</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = trainings.map(training => {
                const progress = calculateProgress(training);
                const startDate = new Date(training.startDate).toLocaleDateString();
                const endDate = new Date(training.endDate).toLocaleDateString();
                const activeSection = getActiveSection(training);
                const sectionNames = {
                    'preTraining': 'Pre-Training Phase',
                    'trainingDay': 'Training Day Phase',
                    'postTraining': 'Post-Training Phase'
                };
                
                return `
                    <div class="training-card" onclick="showChecklist(${training.id})">
                        <h3>${training.title}</h3>
                        <p><strong>Start:</strong> ${startDate}</p>
                        <p><strong>End:</strong> ${endDate}</p>
                        <p><strong>Venue:</strong> ${training.venue}</p>
                        <p><strong>Checker:</strong> ${training.checkerName}</p>
                        <p style="color: #667eea; font-weight: 600; margin-top: 8px;">
                            üìç ${sectionNames[activeSection]}
                        </p>
                        <div class="progress">
                            <div class="progress-bar" style="width: ${progress}%"></div>
                        </div>
                        <p style="margin-top: 10px; text-align: center; font-weight: 600;">${progress}% Complete</p>
                    </div>
                `;
            }).join('');
        }

        function renderTrainingHeader(training) {
            const header = document.getElementById('trainingHeader');
            const startDate = new Date(training.startDate).toLocaleDateString();
            const endDate = new Date(training.endDate).toLocaleDateString();
            
            header.innerHTML = `
                <h2 style="color: #667eea; margin-bottom: 15px;">${training.title}</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong>Start Date:</strong> ${startDate}
                    </div>
                    <div>
                        <strong>End Date:</strong> ${endDate}
                    </div>
                    <div>
                        <strong>Venue:</strong> ${training.venue}
                    </div>
                    <div>
                        <strong>Checker:</strong> ${training.checkerName}
                    </div>
                </div>
            `;

            // Update phase info banner
            const activeSection = getActiveSection(training);
            const phaseInfo = document.getElementById('phaseInfo');
            const phaseTitle = document.getElementById('phaseTitle');
            const phaseDescription = document.getElementById('phaseDescription');
            
            phaseInfo.style.display = 'block';
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const start = new Date(training.startDate);
            start.setHours(0, 0, 0, 0);
            const end = new Date(training.endDate);
            end.setHours(0, 0, 0, 0);

            if (activeSection === 'preTraining') {
                const daysUntil = Math.ceil((start - today) / (1000 * 60 * 60 * 24));
                phaseTitle.textContent = 'üìç Pre-Training Phase';
                phaseDescription.textContent = `You are currently in the Pre-Training phase. The training starts in ${daysUntil} day${daysUntil !== 1 ? 's' : ''}. Only Pre-Training Arrangements section is active.`;
                phaseInfo.style.background = '#dbeafe';
                phaseInfo.style.borderLeft = '4px solid #3b82f6';
                phaseDescription.style.color = '#1e3a8a';
            } else if (activeSection === 'trainingDay') {
                phaseTitle.textContent = 'üìç Training Day Phase';
                phaseDescription.textContent = 'The training is currently in progress. Only Training Day section is active. Pre-Training section is now locked.';
                phaseInfo.style.background = '#dcfce7';
                phaseInfo.style.borderLeft = '4px solid #10b981';
                phaseDescription.style.color = '#14532d';
            } else {
                const daysSince = Math.ceil((today - end) / (1000 * 60 * 60 * 24));
                phaseTitle.textContent = 'üìç Post-Training Phase';
                phaseDescription.textContent = `The training ended ${daysSince} day${daysSince !== 1 ? 's' : ''} ago. Only Post-Training section is active. Previous sections are now locked.`;
                phaseInfo.style.background = '#f3e8ff';
                phaseInfo.style.borderLeft = '4px solid #a855f7';
                phaseDescription.style.color = '#581c87';
            }
        }

        function renderChecklist(training) {
            const container = document.getElementById('checklistContainer');
            const activeSection = getActiveSection(training);
            let html = '';

            for (const [section, data] of Object.entries(checklistData)) {
                const status = getSectionStatus(section, activeSection);
                const sectionClass = status.locked ? 'locked' : '';
                
                html += `
                    <div class="checklist-section ${sectionClass}">
                        <h2>
                            <span>${data.title}</span>
                            <span class="section-status ${status.locked ? 'locked' : 'active'}">
                                ${status.label}
                            </span>
                        </h2>
                `;

                if (status.locked) {
                    html += `
                        <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <p style="color: #78350f; margin: 0;">
                                <strong>‚ö†Ô∏è This section is currently ${section === activeSection ? 'active' : 'locked'}.</strong>
                                ${section !== activeSection ? ' It will unlock based on your training schedule.' : ''}
                            </p>
                        </div>
                    `;
                }

                training.checklist[section].forEach((item, index) => {
                    html += `
                        <div class="checklist-item ${item.completed ? 'completed' : ''}">
                            <input type="checkbox" 
                                   ${item.completed ? 'checked' : ''} 
                                   ${status.locked ? 'disabled' : ''}
                                   onchange="toggleChecklistItem('${section}', ${index})">
                            <div class="checklist-item-content">
                                <div class="checklist-item-header">
                                    <div class="checklist-item-title">${item.id}. ${item.action}</div>
                                </div>
                                <div class="checklist-item-details">
                                    ${item.timeline ? `<span class="detail-badge">‚è∞ ${item.timeline}</span>` : ''}
                                    ${item.responsibility ? `<span class="detail-badge">üë§ ${item.responsibility}</span>` : ''}
                                </div>
                                <input type="text" 
                                       class="signature-input" 
                                       placeholder="Staff Signature" 
                                       value="${item.signature || ''}"
                                       ${status.locked ? 'disabled' : ''}
                                       onchange="updateSignature('${section}', ${index}, this.value)">
                            </div>
                        </div>
                    `;
                });

                html += `</div>`;
            }

            container.innerHTML = html;
        }

        // Checklist Item Management
        function toggleChecklistItem(section, index) {
            const training = trainings.find(t => t.id === currentTrainingId);
            training.checklist[section][index].completed = !training.checklist[section][index].completed;
            saveToLocalStorage();
            renderChecklist(training);
            updateStats(training);
        }

        function updateSignature(section, index, value) {
            const training = trainings.find(t => t.id === currentTrainingId);
            training.checklist[section][index].signature = value;
            saveToLocalStorage();
        }

        // Statistics
        function calculateProgress(training) {
            let total = 0;
            let completed = 0;

            for (const section of Object.values(training.checklist)) {
                total += section.length;
                completed += section.filter(item => item.completed).length;
            }

            return total > 0 ? Math.round((completed / total) * 100) : 0;
        }

        function updateStats(training) {
            let total = 0;
            let completed = 0;

            for (const section of Object.values(training.checklist)) {
                total += section.length;
                completed += section.filter(item => item.completed).length;
            }

            document.getElementById('totalItems').textContent = total;
            document.getElementById('completedItems').textContent = completed;
            document.getElementById('progressPercentage').textContent = 
                total > 0 ? Math.round((completed / total) * 100) + '%' : '0%';
        }

        // Data Management
        function saveToLocalStorage() {
            localStorage.setItem('trainings', JSON.stringify(trainings));
        }

        function clearForm() {
            document.getElementById('trainingTitle').value = '';
            document.getElementById('trainingStartDate').value = '';
            document.getElementById('trainingEndDate').value = '';
            document.getElementById('checkerName').value = '';
            document.getElementById('venue').value = '';
        }

        function exportAllData() {
            const dataStr = JSON.stringify(trainings, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `training-checklists-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function exportTrainingData() {
            const training = trainings.find(t => t.id === currentTrainingId);
            if (!training) return;

            const dataStr = JSON.stringify(training, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${training.title.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (Array.isArray(data)) {
                        // Importing multiple trainings
                        trainings = [...trainings, ...data];
                    } else if (data.id && data.title) {
                        // Importing single training
                        trainings.push(data);
                    } else {
                        throw new Error('Invalid data format');
                    }

                    saveToLocalStorage();
                    showDashboard();
                    alert('Data imported successfully!');
                } catch (error) {
                    alert('Error importing data. Please check the file format.');
                    console.error(error);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }
    </script>
</body>
</html>
